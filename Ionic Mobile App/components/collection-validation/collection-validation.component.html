<app-bottom-sheet title="{{ 'COLLECTIONS.VALIDATION.TITLE' | translate }}">

    <!-- Loading -->
    <div class="h-20" *ngIf="loading; else content">
        <app-loading-spinner></app-loading-spinner>
    </div>

    <!-- Content -->
    <ng-template #content>

        <!-- collections to validate -->
        <ion-grid class="max-h-80 overflow-y-scroll">
            <div class="my-4" *ngFor="let collection of collectionsToValidate">

                <ion-row class="mb-2">
                    <ion-col class="text-theme">
                        <span class="font-semibold">{{ collection.waste }}</span>
                        <span class="font-semibold mx-1">•</span>
                        <span>{{ collection.material }}</span>
                    </ion-col>
                </ion-row>

                <ion-row class="bg-shade-2 rounded-lg flex items-center p-2">
                    <ion-col size="2" class="flex justify-center">
                        <input type="checkbox" [(ngModel)]="collection.selected">
                    </ion-col>
                    <ion-col size="5" class="flex items-center">
                        <ion-label class="text-shade-6 mr-2">
                            {{ 'COLLECTIONS.VALIDATION.QUANTITY' | translate }}
                        </ion-label>
                        <input [(ngModel)]="collection.validationData.quantite" class="box" type="number"/>
                    </ion-col>
                    <ion-col size="5" class="flex items-center">
                        <ion-label class="text-shade-6 mr-2">
                            {{ 'COLLECTIONS.VALIDATION.WEIGHT' | translate }}
                        </ion-label>
                        <input [(ngModel)]="collection.validationData.poids" class="box" type="number"/>
                    </ion-col>
                </ion-row>

            </div>
        </ion-grid>

        <!-- Shared Data -->
        <ion-grid>

            <!-- Dates Inputs -->
            <ion-row class="my-4">

                <!-- Request Date -->
                <ion-col class="flex flex-col items-start" size="6">
                    <ion-label class="text-shade-6 mb-2">
                        {{ 'COLLECTIONS.VALIDATION.CREATED_DATE' | translate }}
                    </ion-label>
                    <app-date-picker
                        cssClasses="p-4"
                        [readonly]="true"
                        [date]="collectionDate"
                    ></app-date-picker>
                </ion-col>

                <!-- Collection Date -->
                <ion-col class="flex flex-col items-start" size="6">
                    <ion-label class="text-shade-6 mb-2">
                        {{ 'COLLECTIONS.VALIDATION.VALIDATION_DATE' | translate }}
                    </ion-label>
                    <app-date-picker
                        cssClasses="p-4"
                        [date]="realizedDate"
                        [maxDate]="getTodayDate()"
                        (dateChange)="realizedDate = $event"
                    ></app-date-picker>
                </ion-col>

            </ion-row>

            <!-- Images -->
            <ion-row class="mt-4">
                <ion-col>
                    <div *ngFor="let image of images; let imageIndex = index" class="relative inline-block mr-2">
                        <div
                            (click)="removeImage(imageIndex)"
                            class="remove-image"
                        >
                            <ion-icon name="close"></ion-icon>
                        </div>
                        <img
                            [src]="image.webPath"
                            alt="collection-image"
                            class="rounded-lg"
                            height="60"
                            width="60"
                        />
                    </div>
                </ion-col>
            </ion-row>

            <!-- Actions -->
            <ion-row>
                <ion-col>
                    <div class="actions">

                        <!-- Camera -->
                        <div class="w-1/3">
                            <ion-button
                                (click)="takeOrGetAPhoto()"
                                [disabled]="images.length === CameraPhotoConfig.IMAGES_LIMIT"
                                class="w-full m-0 h-12"
                                fill="clear"
                            >
                                <ion-icon class="text-shade-5" name="camera" size="large"></ion-icon>
                            </ion-button>
                        </div>

                        <!-- Comments -->
                        <div class="w-1/3 action-dividers">
                            <ion-button
                                class="w-full m-0 h-12"
                                fill="clear"
                                (click)="addComment = true; addAnomaly = false;"
                            >
                                <ion-icon class="text-shade-5" size="large" src="assets/svg/ic_comment.svg"></ion-icon>
                                <ion-badge *ngIf="comment" class="badge" color="app">&nbsp;</ion-badge>
                            </ion-button>
                        </div>

                        <!-- Anomalies -->
                        <div class="w-1/3">
                            <ion-button
                                class="w-full m-0 h-12"
                                fill="clear"
                                (click)="addComment = false; addAnomaly = true;"
                            >
                                <ion-icon class="text-shade-5" size="large" src="assets/svg/ic_info.svg"></ion-icon>
                                <ion-badge *ngIf="anomalyType" class="badge" color="app">&nbsp;</ion-badge>
                            </ion-button>
                        </div>

                    </div>
                </ion-col>
            </ion-row>

            <!-- Comment -->
            <ion-row class="text-theme mt-2" *ngIf="addComment">
                <ion-col class="text-shade-6" size="12">{{ 'COLLECTIONS.VALIDATION.COMMENT' | translate }}</ion-col>
                <ion-col>
                    <ion-textarea
                        [(ngModel)]="comment"
                        [autoGrow]="true"
                        [rows]="2"
                        class="border border-solid border-shade-3 rounded-lg p-2 bg-wizard-item"
                    ></ion-textarea>
                </ion-col>
            </ion-row>

            <!-- Anomaly -->
            <ion-row class="text-theme mt-2" *ngIf="addAnomaly">
                <ion-col class="text-shade-6" size="12">{{ 'COLLECTIONS.VALIDATION.ANOMALY_TYPE' | translate }}</ion-col>
                <ion-col size="12">
                    <ion-select
                        class="border border-solid border-shade-3 rounded-lg p-4"
                        [(ngModel)]="anomalyType"
                    >
                        <ion-select-option value="">{{ 'ANOMALIE.SELECTION' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Erreur de tri">{{ 'ANOMALIE.ERREUR_TRI' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Matériel abimé">{{ 'ANOMALIE.MATERIEL_ABIME' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Matériel sale">{{ 'ANOMALIE.MATERIEL_SALE' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Problème d’attente">{{ 'ANOMALIE.PROBLEME_ATTENTE' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Problème de document">{{ 'ANOMALIE.PROBLEME_DOCUMENT' | translate }}</ion-select-option>
                        <ion-select-option
                            value="Autre (Préciser)">{{ 'ANOMALIE.AUTRE' | translate }}</ion-select-option>
                    </ion-select>
                </ion-col>
                <ion-col size="12" class="mt-2">{{ 'COLLECTIONS.VALIDATION.ANOMALY' | translate }}</ion-col>
                <ion-col size="12">
                    <ion-textarea
                        [(ngModel)]="anomaly"
                        [autoGrow]="true"
                        [rows]="2"
                        class="border border-solid border-shade-3 rounded-lg p-2 bg-wizard-item"
                    ></ion-textarea>
                </ion-col>
            </ion-row>

        </ion-grid>

        <!-- Validation -->
        <div class="sticky bottom-1 z-10 bg-wizard-item">
            <ion-button
                color="app"
                [disabled]="cantValidate()"
                (click)="validateCollection()"
                class="h-14"
                expand="block"
            >

                <!-- Validation Label -->
                <ion-label *ngIf="!validating; else validationProgress">
                    {{ 'COLLECTIONS.VALIDATION.VALIDATE_COLLECTION' | translate }}
                </ion-label>

                <!-- Validation Progress -->
                <ng-template #validationProgress>
                    <div class="flex justify-center items-center">
                        <ion-spinner></ion-spinner>
                    </div>
                </ng-template>

            </ion-button>
        </div>

    </ng-template>

</app-bottom-sheet>
